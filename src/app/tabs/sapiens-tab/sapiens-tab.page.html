<app-header></app-header>

<ion-content>
  <div class="flex flex-col h-full">
    <!-- Área de mensajes del chat con desplazamiento -->
    <div class="flex-1 overflow-auto p-4 space-y-4" #messageContainer>
      <div *ngFor="let msg of chatMessages; let i = index" id="message-{{i}}">
        <div class="w-full flex fade-in"
          [ngClass]="{'justify-end': msg.sender === 'user', 'justify-start': msg.sender === 'app'}">
          <div class="relative p-4 rounded-3xl inline-block"
            [ngClass]="{'rounded-bl-none bg-blue-500 text-white': msg.sender === 'app', 'rounded-br-none bg-gray-200 text-black': msg.sender === 'user'}">
            <p>{{ msg.text }}</p>
          </div>
        </div>

        <!-- Añade un app-swiper si hay resultados de búsqueda -->
        <ng-container *ngIf="msg.searchResults && msg.searchResults.length > 0">
          <app-swiper [items]="msg.searchResults" title="Resultados" containerClass="pt-4 fade-in"></app-swiper>
        </ng-container>
      </div>

      <!-- Indicador de carga -->
      <div *ngIf="isLoading" class="flex justify-center items-center py-2">
        <span class="dot h-2 w-2 bg-cyan-700 rounded-full mr-2 animate-[ping_2s_infinite]"></span>
        <span class="dot h-3 w-3 bg-sky-600 rounded-full mr-2 animate-[ping_2s_infinite_500ms]"></span>
        <span class="dot h-4 w-4 bg-blue-500 rounded-full animate-[ping_2s_infinite_1000ms]"></span>
      </div>
    </div>
  </div>

  <div class="ion-padding-bottom"></div>
</ion-content>

<!-- Barra de búsqueda fija en la parte inferior -->
<ion-footer>
  <ion-toolbar class="bg-[var(--ion-tab-bar-background)]">
    <div class="flex items-center p-4">
      <input type="text" id="prueba"
        class="flex-1 rounded-full dark:bg-gray-600 dark:text-white dark:placeholder-stone-300"
        placeholder="Escribe aquí..." [(ngModel)]="searchText" (keyup.enter)="searchMovies()" />
      <ion-button fill="clear" (click)="searchMovies()">
        <ion-icon name="send"></ion-icon>
      </ion-button>
    </div>
  </ion-toolbar>
</ion-footer>